# React性能优化
https://www.doubao.com/thread/w4dea2fde4df1f588

减少渲染触发次数 + 降低单次渲染成本。

使用 React.lazy 和 Suspense 实现代码分割，减少初始渲染的组件数量。
避免在渲染过程中创建新对象/数组（如 style={{ color: 'red' }} 会每次创建新对象），可提取为常量。


3. 避免在渲染阶段执行副作用
Fiber 会中断并重启渲染过程（如低优先级任务被打断后重新执行），若在 render 或 useMemo 中执行副作用（如请求数据、修改全局变量），会导致副作用被重复执行。

将副作用放在 useEffect 中（提交阶段执行，不会被中断）：

4. 拆分大型组件，减少单次渲染计算量
5. 合理使用 key 优化列表 Diff

/////// 
1. 减少不必要的组件重渲染
使用 React.memo 缓存组件：仅在**组件接收的 props 发生变化时才重新渲染**
用 useCallback 缓存函数引用
用 useMemo 缓存计算结果（通常是对象、数组等引用类型），避免组件重新渲染时“重复计算”

2. 列表渲染优化
合理使用 key 属性
列表渲染时，key 需唯一且稳定（避免用索引），
虚拟列表（大数据列表优化）：可使用 react-window 或 react-virtualized 库

3. 代码分割与懒加载
* 组件懒加载
用 React.lazy 和 Suspense 实现组件按需加载，减小初始 bundle 体积，加快首屏加载：
```js
// 懒加载组件
const LazyComponent = React.lazy(() => import('./LazyComponent'));

// 使用时包裹Suspense（提供加载状态）
const App = () => (
  <Suspense fallback={<div>加载中...</div>}>
    <LazyComponent />
  </Suspense>
);
```

* 路由级别分割
结合路由库（如 React Router）对不同路由页面进行分割，仅加载当前路由所需代码：
```js
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';

const Home = React.lazy(() => import('./pages/Home'));
const About = React.lazy(() => import('./pages/About'));

const App = () => (
  <Router>
    <Suspense fallback={<div>加载中...</div>}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  </Router>
);
```
5. 其他实用技巧
* 避免渲染时创建新对象/数组
渲染过程中创建新对象（如 style={{ color: 'red' }}）或数组会导致 React.memo 或 useMemo 的比较失效，触发不必要的重渲染。应将其提取为常量或用 useMemo 缓存。
* 使用 React.Profiler 定位性能瓶颈
通过 Profiler 组件测量组件渲染时间，精准定位需要优化的部分：
```js
<Profiler id="MyComponent" onRender={(id, phase, actualDuration) => {
  console.log(`${id} 渲染耗时: ${actualDuration}ms`);
}}>
  <MyComponent />
</Profiler>
```
* 使用 Web Workers 处理 heavy 计算
复杂计算（如数据解析、图表渲染）会阻塞主线程，导致 UI 卡顿。可将计算逻辑放入 Web Worker，避免影响渲染：
```js
// 主线程中创建Worker
const worker = new Worker(new URL('./calculation.worker.js', import.meta.url));

// 发送数据给Worker
worker.postMessage(largeData);

// 接收计算结果
worker.onmessage = (e) => {
  setResult(e.data);
};
```